import streamlit as st
import pandas as pd
import numpy as np
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(
    page_title="–ê–Ω–∞–ª–∏–∑ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ü–∏–∏",
    page_icon="üìä",
    layout="wide"
)

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
st.title("üìä –ê–Ω–∞–ª–∏–∑ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ü–∏–∏")
st.markdown("---")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
if 'base_data' not in st.session_state:
    # –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞)
    # –ó–¥–µ—Å—å —Å–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
    
    # –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∑–∞—Ç—Ä–∞—Ç–∞–º
    st.session_state.base_data = {
        '–í—ã—Ä—É—á–∫–∞': 620000000,
        '–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã': 45000000,
        '–§–û–¢ –ü–†': 97689625.69,
        '–û—Å—Ç–∞–ª—å–Ω—ã–µ –ü–†': 22530143.49,
        '–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –ü–†': 50628156.84,
        '–§–û–¢ –û–ü–†': 143704063.88,
        '–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –û–ü–†': 8527933.20,
        '–û—Å—Ç–∞–ª—å–Ω—ã–µ –û–ü–†': 28015544.97,
        '–§–û–¢ –û–•–†': 58189393.57,
        '–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –û–•–†': 12291689.47,
        '–û—Å—Ç–∞–ª—å–Ω—ã–µ –û–•–†': 67382397.10,
        '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã': 195860.72,
        '–õ–æ–≥–∏—Å—Ç–∏–∫–∞ HUB': 959983.83,
        '–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –í–Ω–µ—à–∫–∞': 19590419.54,
        '–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –ë–∞—Ä—Ç–æ–Ω': 704202.91,
        '–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º': 106105864.26
    }
    
    # –î–∞–Ω–Ω—ã–µ –ø–æ –≥—Ä—É–ø–ø–∞–º –ø—Ä–æ–¥—É–∫—Ü–∏–∏
    st.session_state.groups = {
        '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∑–∞–∫–∞–∑': ['–ú–æ–¥–µ–ª—å 1', '–ú–æ–¥–µ–ª—å 2', '–ú–æ–¥–µ–ª—å 3'],
        '–í–Ω–µ—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã': ['–ú–æ–¥–µ–ª—å 4', '–ú–æ–¥–µ–ª—å 5', '–ú–æ–¥–µ–ª—å 6', '–ú–æ–¥–µ–ª—å 7', '–ú–æ–¥–µ–ª—å 8', '–ú–æ–¥–µ–ª—å 9'],
        '–í—ã—á—Ç–µ—Ö': ['–ú–æ–¥–µ–ª—å 10', '–ú–æ–¥–µ–ª—å 11', '–ú–æ–¥–µ–ª—å 12']
    }
    
    # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –º–æ–¥–µ–ª—è–º
    st.session_state.models_data = {}
    
    # –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–µ–ª–µ–π
    for group, models in st.session_state.groups.items():
        for model in models:
            st.session_state.models_data[model] = {
                '–ì—Ä—É–ø–ø–∞': group,
                '–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å': np.random.randint(100, 1000),
                '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø—É—Å–∫–∞': np.random.randint(1000, 10000),
                '–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥': np.random.uniform(10, 100),
                '–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥': np.random.uniform(5, 50) if group == '–í–Ω–µ—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã' else 0,
                '–¶–µ–Ω–∞ –±–µ–∑ –ù–î–°': np.random.uniform(200, 500)
            }

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
def calculate_metrics(models_data, base_data, —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å_–ø—Ä–æ—Ü–µ–Ω—Ç=30, –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞=None):
    """
    –†–∞—Å—á–µ—Ç –≤—Å–µ—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
    
    Args:
        models_data: –¥–∞–Ω–Ω—ã–µ –ø–æ –º–æ–¥–µ–ª—è–º
        base_data: –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∑–∞—Ç—Ä–∞—Ç–∞–º
        —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å_–ø—Ä–æ—Ü–µ–Ω—Ç: –ø—Ä–æ—Ü–µ–Ω—Ç —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
        –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞: —Å–ª–æ–≤–∞—Ä—å —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ –º–æ–¥–µ–ª—è–º
    """
    
    # –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
    calc_data = {}
    
    # –û–±—â–∞—è —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å –ø–æ –≤—Å–µ–º –º–æ–¥–µ–ª—è–º
    –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å = 0
    –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–ø–æ_–≥—Ä—É–ø–ø–∞–º = {}
    
    # –°–Ω–∞—á–∞–ª–∞ —Å–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
    for model, data in models_data.items():
        group = data['–ì—Ä—É–ø–ø–∞']
        —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å = data['–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å']
        –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø—É—Å–∫–∞']
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
        if –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ and model in –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:
            –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞[model]
        
        # –û–±—â–∞—è —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å –ø–æ –º–æ–¥–µ–ª–∏
        –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–º–æ–¥–µ–ª–∏ = —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å += –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–º–æ–¥–µ–ª–∏
        
        if group not in –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–ø–æ_–≥—Ä—É–ø–ø–∞–º:
            –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] = 0
        –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] += –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–º–æ–¥–µ–ª–∏
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        calc_data[model] = {
            '–ì—Ä—É–ø–ø–∞': group,
            '–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–µ–¥': —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å,
            '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ,
            '–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–æ–±—â–∞—è': –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–º–æ–¥–µ–ª–∏
        }
    
    # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞—Ç—Ä–∞—Ç—ã –ø–æ —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏
    for model, data in calc_data.items():
        group = data['–ì—Ä—É–ø–ø–∞']
        –¥–æ–ª—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏ = data['–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–æ–±—â–∞—è'] / –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å if –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å > 0 else 0
        
        # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞—Ç—Ä–∞—Ç—ã (–∫—Ä–æ–º–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã—Ö)
        for cost_name, cost_value in base_data.items():
            if cost_name not in ['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã', '–í—ã—Ä—É—á–∫–∞']:
                # –î–ª—è –ª–æ–≥–∏—Å—Ç–∏–∫–∏ - —Ç–æ–ª—å–∫–æ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã
                if '–õ–æ–≥–∏—Å—Ç–∏–∫–∞' in cost_name and group != '–í–Ω–µ—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã':
                    calc_data[model][cost_name] = 0
                else:
                    calc_data[model][cost_name] = cost_value * –¥–æ–ª—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏ / data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] if data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] > 0 else 0
        
        # –ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        calc_data[model]['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥'] = models_data[model]['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥']
        calc_data[model]['–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥'] = models_data[model]['–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥']
        
        # –†–∞—Å—á–µ—Ç –ø–æ–ª–Ω–æ–π —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏
        –ø—Ä—è–º—ã–µ_—Ä–∞—Å—Ö–æ–¥—ã = (
            calc_data[model]['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥'] +
            calc_data[model]['–§–û–¢ –ü–†'] +
            calc_data[model]['–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥']
        )
        
        –Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–±–µ–∑_–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏ = (
            calc_data[model]['–§–û–¢ –û–ü–†'] +
            calc_data[model]['–û—Å—Ç–∞–ª—å–Ω—ã–µ –ü–†'] +
            calc_data[model]['–û—Å—Ç–∞–ª—å–Ω—ã–µ –û–ü–†'] +
            calc_data[model]['–§–û–¢ –û–•–†'] +
            calc_data[model]['–û—Å—Ç–∞–ª—å–Ω—ã–µ –û–•–†'] +
            calc_data[model]['–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã']
        )
        
        –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è = (
            calc_data[model]['–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –ü–†'] +
            calc_data[model]['–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –û–ü–†'] +
            calc_data[model]['–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è –û–•–†']
        )
        
        –ø–æ–ª–Ω–∞—è_—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å = (
            –ø—Ä—è–º—ã–µ_—Ä–∞—Å—Ö–æ–¥—ã +
            –Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–±–µ–∑_–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏ +
            –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è +
            calc_data[model]['–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º']
        )
        
        # –¶–µ–Ω–∞ —Å —É—á–µ—Ç–æ–º —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
        —Ü–µ–Ω–∞_–±–µ–∑_–Ω–¥—Å = –ø–æ–ª–Ω–∞—è_—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å * (1 + —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å_–ø—Ä–æ—Ü–µ–Ω—Ç / 100)
        
        # –†–∞—Å—á–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
        –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π_–¥–æ—Ö–æ–¥ = —Ü–µ–Ω–∞_–±–µ–∑_–Ω–¥—Å - (
            calc_data[model]['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥'] +
            calc_data[model]['–§–û–¢ –ü–†'] +
            calc_data[model]['–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥']
        )
        
        ebitda = —Ü–µ–Ω–∞_–±–µ–∑_–Ω–¥—Å - (
            calc_data[model]['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥'] +
            calc_data[model]['–§–û–¢ –ü–†'] +
            calc_data[model]['–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥'] +
            –Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–±–µ–∑_–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏
        )
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç—ã
        calc_data[model].update({
            '–ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã': –ø—Ä—è–º—ã–µ_—Ä–∞—Å—Ö–æ–¥—ã,
            '–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã': –Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–±–µ–∑_–∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏,
            '–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è': –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è,
            '–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å': –ø–æ–ª–Ω–∞—è_—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å,
            '–¶–µ–Ω–∞ –±–µ–∑ –ù–î–°': —Ü–µ–Ω–∞_–±–µ–∑_–Ω–¥—Å,
            '–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥': –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π_–¥–æ—Ö–æ–¥,
            'EBITDA': ebitda
        })
    
    return calc_data, –æ–±—â–∞—è_—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–ø–æ_–≥—Ä—É–ø–ø–∞–º

# –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
with st.sidebar:
    st.header("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞")
    
    # –°–ª–∞–π–¥–µ—Ä –¥–ª—è —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
    st.subheader("–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å")
    —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å = st.slider(
        "–ü—Ä–æ—Ü–µ–Ω—Ç —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏, %",
        min_value=0,
        max_value=100,
        value=30,
        step=1,
        key="—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å_—Å–ª–∞–π–¥–µ—Ä"
    )
    
    st.markdown("---")
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º
    st.subheader("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–ø—É—Å–∫–∞")
    
    –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ = {}
    
    for group_name, models in st.session_state.groups.items():
        with st.expander(f"–ì—Ä—É–ø–ø–∞: {group_name}"):
            for model in models:
                —Ç–µ–∫—É—â–µ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = st.session_state.models_data[model]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø—É—Å–∫–∞']
                –Ω–æ–≤–æ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = st.number_input(
                    f"{model}",
                    min_value=0,
                    max_value=100000,
                    value=int(—Ç–µ–∫—É—â–µ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ),
                    step=100,
                    key=f"–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_{model}"
                )
                –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞[model] = –Ω–æ–≤–æ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

# –†–∞—Å—á–µ—Ç –¥–∞–Ω–Ω—ã—Ö
—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ, —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–ø–æ_–≥—Ä—É–ø–ø–∞–º = calculate_metrics(
    st.session_state.models_data, 
    st.session_state.base_data,
    —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å,
    –∏–∑–º–µ–Ω–µ–Ω–∏—è_–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
)

# –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
–∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞ = 0
–∏—Ç–æ–≥–æ_–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π_–¥–æ—Ö–æ–¥ = 0
–∏—Ç–æ–≥–æ_ebitda = 0
–∏—Ç–æ–≥–æ_–ø—Ä–∏–±—ã–ª—å = 0

for model, data in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ.items():
    –∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞ += data['–¶–µ–Ω–∞ –±–µ–∑ –ù–î–°'] * data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
    –∏—Ç–æ–≥–æ_–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π_–¥–æ—Ö–æ–¥ += data['–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥'] * data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
    –∏—Ç–æ–≥–æ_ebitda += data['EBITDA'] * data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
    –ø—Ä–∏–±—ã–ª—å_–º–æ–¥–µ–ª–∏ = (data['–¶–µ–Ω–∞ –±–µ–∑ –ù–î–°'] - data['–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å']) * data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
    –∏—Ç–æ–≥–æ_–ø—Ä–∏–±—ã–ª—å += –ø—Ä–∏–±—ã–ª—å_–º–æ–¥–µ–ª–∏

–∏—Ç–æ–≥–æ–≤–∞—è_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å = (–∏—Ç–æ–≥–æ_–ø—Ä–∏–±—ã–ª—å / –∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞ * 100) if –∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞ > 0 else 0

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
st.subheader("üìà –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏")

col1, col2, col3, col4 = st.columns(4)

with col1:
    st.metric(
        "–í—ã—Ä—É—á–∫–∞",
        f"{–∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞:,.0f} ‚ÇΩ",
        delta=f"{—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å}% —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å"
    )

with col2:
    st.metric(
        "EBITDA",
        f"{–∏—Ç–æ–≥–æ_ebitda:,.0f} ‚ÇΩ",
        delta=f"{–∏—Ç–æ–≥–æ_ebitda/–∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞*100:.1f}% –º–∞—Ä–∂–∞"
    )

with col3:
    st.metric(
        "–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥",
        f"{–∏—Ç–æ–≥–æ_–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π_–¥–æ—Ö–æ–¥:,.0f} ‚ÇΩ",
        delta=f"{–∏—Ç–æ–≥–æ_–º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π_–¥–æ—Ö–æ–¥/–∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞*100:.1f}%"
    )

with col4:
    st.metric(
        "–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å",
        f"{–∏—Ç–æ–≥–æ–≤–∞—è_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å:.1f}%",
        delta=f"{–∏—Ç–æ–≥–æ_–ø—Ä–∏–±—ã–ª—å:,.0f} ‚ÇΩ –ø—Ä–∏–±—ã–ª—å"
    )

st.markdown("---")

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞—Ç—Ä–∞—Ç
st.subheader("üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –ø–æ –≥—Ä—É–ø–ø–∞–º")

fig = make_subplots(
    rows=1, cols=3,
    subplot_titles=["–ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã", "–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã", "–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å"],
    specs=[[{'type': 'pie'}, {'type': 'pie'}, {'type': 'pie'}]]
)

# –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –≥—Ä—É–ø–ø–∞–º
–ø—Ä—è–º—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º = {}
–Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º = {}
–ø–æ–ª–Ω–∞—è_–ø–æ_–≥—Ä—É–ø–ø–∞–º = {}

for model, data in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ.items():
    group = data['–ì—Ä—É–ø–ø–∞']
    –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
    
    if group not in –ø—Ä—è–º—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º:
        –ø—Ä—è–º—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] = 0
        –Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] = 0
        –ø–æ–ª–Ω–∞—è_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] = 0
    
    –ø—Ä—è–º—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] += data['–ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã'] * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    –Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] += data['–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã'] * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    –ø–æ–ª–Ω–∞—è_–ø–æ_–≥—Ä—É–ø–ø–∞–º[group] += data['–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å'] * –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

# –î–∏–∞–≥—Ä–∞–º–º—ã
fig.add_trace(
    go.Pie(
        labels=list(–ø—Ä—è–º—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º.keys()),
        values=list(–ø—Ä—è–º—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º.values()),
        hole=.3,
        marker_colors=['#FF6B6B', '#4ECDC4', '#45B7D1']
    ),
    row=1, col=1
)

fig.add_trace(
    go.Pie(
        labels=list(–Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º.keys()),
        values=list(–Ω–∞–∫–ª–∞–¥–Ω—ã–µ_–ø–æ_–≥—Ä—É–ø–ø–∞–º.values()),
        hole=.3,
        marker_colors=['#FF6B6B', '#4ECDC4', '#45B7D1']
    ),
    row=1, col=2
)

fig.add_trace(
    go.Pie(
        labels=list(–ø–æ–ª–Ω–∞—è_–ø–æ_–≥—Ä—É–ø–ø–∞–º.keys()),
        values=list(–ø–æ–ª–Ω–∞—è_–ø–æ_–≥—Ä—É–ø–ø–∞–º.values()),
        hole=.3,
        marker_colors=['#FF6B6B', '#4ECDC4', '#45B7D1']
    ),
    row=1, col=3
)

fig.update_layout(
    height=400,
    showlegend=True,
    title_text="–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –ø–æ –≥—Ä—É–ø–ø–∞–º –ø—Ä–æ–¥—É–∫—Ü–∏–∏"
)

st.plotly_chart(fig, use_container_width=True)

st.markdown("---")

# –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –≥—Ä—É–ø–ø–∞–º
st.subheader("üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–æ –≥—Ä—É–ø–ø–∞–º –ø—Ä–æ–¥—É–∫—Ü–∏–∏")

for group_name, models in st.session_state.groups.items():
    with st.expander(f"üìÅ {group_name} (–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å: {—Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–ø–æ_–≥—Ä—É–ø–ø–∞–º.get(group_name, 0):,.0f} —á–µ–ª*—Å–µ–∫)", expanded=True):
        
        # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ –º–æ–¥–µ–ª—è–º
        table_data = []
        –≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ = {
            '–í—ã—Ä—É—á–∫–∞': 0,
            '–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥': 0,
            'EBITDA': 0,
            '–ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã': 0,
            '–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã': 0,
            '–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å': 0
        }
        
        for model in models:
            if model in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ:
                data = —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[model]
                
                # –°—É–º–º–∏—Ä—É–µ–º –≥—Ä—É–ø–ø–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
                for key in –≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏.keys():
                    if key in ['–í—ã—Ä—É—á–∫–∞', '–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥', 'EBITDA']:
                        value_key = key
                        –º–Ω–æ–∂–∏—Ç–µ–ª—å = data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
                    elif key == '–ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã':
                        value_key = key
                        –º–Ω–æ–∂–∏—Ç–µ–ª—å = data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
                    elif key == '–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã':
                        value_key = key
                        –º–Ω–æ–∂–∏—Ç–µ–ª—å = data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
                    elif key == '–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å':
                        value_key = key
                        –º–Ω–æ–∂–∏—Ç–µ–ª—å = data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']
                    else:
                        value_key = key
                        –º–Ω–æ–∂–∏—Ç–µ–ª—å = 1
                    
                    if value_key in data:
                        –≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏[key] += data[value_key] * –º–Ω–æ–∂–∏—Ç–µ–ª—å
                
                # –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É
                table_data.append({
                    '–ú–æ–¥–µ–ª—å': model,
                    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, —à—Ç': f"{data['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']:,}",
                    '–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å –µ–¥.': f"{data['–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å_–µ–¥']:,}",
                    '–¶–µ–Ω–∞ –±–µ–∑ –ù–î–°, ‚ÇΩ': f"{data['–¶–µ–Ω–∞ –±–µ–∑ –ù–î–°']:,.2f}",
                    '–ú–∞—Ä–∂. –¥–æ—Ö–æ–¥, ‚ÇΩ': f"{data['–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥']:,.2f}",
                    'EBITDA, ‚ÇΩ': f"{data['EBITDA']:,.2f}",
                    '–ü–æ–ª–Ω–∞—è —Å/—Å, ‚ÇΩ': f"{data['–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å']:,.2f}"
                })
        
        # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≥—Ä—É–ø–ø–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        col1, col2, col3, col4 = st.columns(4)
        
        with col1:
            st.metric(
                "–í—ã—Ä—É—á–∫–∞ –≥—Ä—É–ø–ø—ã",
                f"{–≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏['–í—ã—Ä—É—á–∫–∞']:,.0f} ‚ÇΩ"
            )
        
        with col2:
            st.metric(
                "–ú–∞—Ä–∂. –¥–æ—Ö–æ–¥",
                f"{–≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏['–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥']:,.0f} ‚ÇΩ"
            )
        
        with col3:
            st.metric(
                "EBITDA",
                f"{–≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏['EBITDA']:,.0f} ‚ÇΩ"
            )
        
        with col4:
            —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å_–≥—Ä—É–ø–ø—ã = ((–≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏['–í—ã—Ä—É—á–∫–∞'] - –≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏['–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å']) / 
                                    –≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏['–í—ã—Ä—É—á–∫–∞'] * 100) if –≥—Ä—É–ø–ø–æ–≤—ã–µ_–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏['–í—ã—Ä—É—á–∫–∞'] > 0 else 0
            st.metric(
                "–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å",
                f"{—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å_–≥—Ä—É–ø–ø—ã:.1f}%"
            )
        
        # –¢–∞–±–ª–∏—Ü–∞ —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–æ –º–æ–¥–µ–ª—è–º
        st.markdown("**–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–æ–¥–µ–ª—è–º:**")
        df_table = pd.DataFrame(table_data)
        st.dataframe(df_table, use_container_width=True, hide_index=True)
        
        # –ì—Ä–∞—Ñ–∏–∫ –≤–∫–ª–∞–¥–∞ –º–æ–¥–µ–ª–µ–π –≤ –≤—ã—Ä—É—á–∫—É –≥—Ä—É–ø–ø—ã
        fig_group = go.Figure()
        
        –º–æ–¥–µ–ª–∏_–≤_–≥—Ä—É–ø–ø–µ = []
        –≤—ã—Ä—É—á–∫–∞_–ø–æ_–º–æ–¥–µ–ª—è–º = []
        
        for model in models:
            if model in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ:
                –º–æ–¥–µ–ª–∏_–≤_–≥—Ä—É–ø–ø–µ.append(model)
                –≤—ã—Ä—É—á–∫–∞_–ø–æ_–º–æ–¥–µ–ª—è–º.append(—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[model]['–¶–µ–Ω–∞ –±–µ–∑ –ù–î–°'] * —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[model]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'])
        
        fig_group.add_trace(go.Bar(
            x=–º–æ–¥–µ–ª–∏_–≤_–≥—Ä—É–ø–ø–µ,
            y=–≤—ã—Ä—É—á–∫–∞_–ø–æ_–º–æ–¥–µ–ª—è–º,
            name='–í—ã—Ä—É—á–∫–∞',
            marker_color='#4ECDC4'
        ))
        
        fig_group.update_layout(
            title=f'–í–∫–ª–∞–¥ –º–æ–¥–µ–ª–µ–π –≤ –≤—ã—Ä—É—á–∫—É –≥—Ä—É–ø–ø—ã "{group_name}"',
            xaxis_title='–ú–æ–¥–µ–ª—å',
            yaxis_title='–í—ã—Ä—É—á–∫–∞, ‚ÇΩ',
            height=400,
            showlegend=False
        )
        
        st.plotly_chart(fig_group, use_container_width=True)

st.markdown("---")

# –ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
st.subheader("üìà –ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º")

col1, col2 = st.columns(2)

with col1:
    st.markdown("**–í–ª–∏—è–Ω–∏–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –≤—ã—Ä—É—á–∫—É:**")
    
    # –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    —É—Ä–æ–≤–Ω–∏_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ = list(range(10, 51, 5))
    –≤—ã—Ä—É—á–∫–∞_–ø–æ_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ = []
    
    for —Ä–µ–Ω—Ç in —É—Ä–æ–≤–Ω–∏_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏:
        # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        –≤—ã—Ä—É—á–∫–∞_–ø—Ä–∏_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ = –∏—Ç–æ–≥–æ_–≤—ã—Ä—É—á–∫–∞ * (1 + (—Ä–µ–Ω—Ç - —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å) / 100)
        –≤—ã—Ä—É—á–∫–∞_–ø–æ_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏.append(–≤—ã—Ä—É—á–∫–∞_–ø—Ä–∏_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏)
    
    fig_rent = go.Figure()
    fig_rent.add_trace(go.Scatter(
        x=—É—Ä–æ–≤–Ω–∏_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏,
        y=–≤—ã—Ä—É—á–∫–∞_–ø–æ_—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏,
        mode='lines+markers',
        name='–í—ã—Ä—É—á–∫–∞',
        line=dict(color='#FF6B6B', width=3)
    ))
    
    fig_rent.add_vline(
        x=—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å,
        line_width=2,
        line_dash="dash",
        line_color="green",
        annotation_text=f"–¢–µ–∫—É—â–∞—è {—Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å}%"
    )
    
    fig_rent.update_layout(
        xaxis_title='–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, %',
        yaxis_title='–í—ã—Ä—É—á–∫–∞, ‚ÇΩ',
        height=300
    )
    
    st.plotly_chart(fig_rent, use_container_width=True)

with col2:
    st.markdown("**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –ø–æ —Ç–∏–ø–∞–º:**")
    
    —Ç–∏–ø—ã_–∑–∞—Ç—Ä–∞—Ç = ['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ', '–§–û–¢', '–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è', '–ù–∞–∫–ª–∞–¥–Ω—ã–µ', '–õ–æ–≥–∏—Å—Ç–∏–∫–∞', '–ü—Ä–æ—Ü–µ–Ω—Ç—ã']
    –∑–Ω–∞—á–µ–Ω–∏—è_–∑–∞—Ç—Ä–∞—Ç = [
        sum(—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –µ–¥'] * —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] for m in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ),
        sum(—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–§–û–¢ –ü–†'] * —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] for m in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ),
        sum(—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ê–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—è'] * —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] for m in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ),
        sum(—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã'] * —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] for m in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ),
        sum(—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –Ω–∞ –µ–¥'] * —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] for m in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ),
        sum(—Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º'] * —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ[m]['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] for m in —Ä–∞—Å—á–µ—Ç–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ)
    ]
    
    fig_costs = go.Figure(data=[go.Pie(
        labels=—Ç–∏–ø—ã_–∑–∞—Ç—Ä–∞—Ç,
        values=–∑–Ω–∞—á–µ–Ω–∏—è_–∑–∞—Ç—Ä–∞—Ç,
        hole=.4,
        marker_colors=['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD']
    )])
    
    fig_costs.update_layout(
        height=300,
        showlegend=True
    )
    
    st.plotly_chart(fig_costs, use_container_width=True)

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
st.markdown("---")
st.subheader("‚ÑπÔ∏è –ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º")

with st.expander("–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ä–∞—Å—á–µ—Ç–∞"):
    st.markdown("""
    ### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π:
    
    **–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥** = –¶–µ–Ω–∞ - (–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã + –§–û–¢ –ü–† + –õ–æ–≥–∏—Å—Ç–∏–∫–∞)
    
    **EBITDA** = –¶–µ–Ω–∞ - (–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã + –§–û–¢ –ü–† + –õ–æ–≥–∏—Å—Ç–∏–∫–∞ + –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –±–µ–∑ –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏)
    
    **–ü—Ä—è–º—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** = –ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã + –õ–æ–≥–∏—Å—Ç–∏–∫–∞ + –§–û–¢ –ü–†
    
    **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã** = –§–û–¢ –û–ü–† + –û—Å—Ç–∞–ª—å–Ω—ã–µ –ü–† + –ù–∞–∫–ª–∞–¥–Ω—ã–µ –û–ü–† + –§–û–¢ –û–•–† + –ù–∞–∫–ª–∞–¥–Ω—ã–µ –û–•–† + –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã
    
    **–ü–æ–ª–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å** = –í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã (–≤–∫–ª—é—á–∞—è –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã)
    
    ### –ú–µ—Ç–æ–¥ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
    - –í—Å–µ –∑–∞—Ç—Ä–∞—Ç—ã (–∫—Ä–æ–º–µ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã—Ö) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç–∏
    - –õ–æ–≥–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–∫–∞–∑—ã
    - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–ø—É—Å–∫–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç
    """)

# –§—É—Ç–µ—Ä
st.markdown("---")
st.caption("–û—Ç—á–µ—Ç –ø–æ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ü–∏–∏ | –û–±–Ω–æ–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤")